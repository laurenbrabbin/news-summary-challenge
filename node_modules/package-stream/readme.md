# package-stream

An endless stream of [nice package data](https://github.com/zeke/nice-package)
from the npm registry.

See also [all-the-packages](https://github.com/zeke/all-the-packages), a similar
package designed for offline use.

## Installation

```sh
npm install package-stream --save
```

## Usage

The stream is an event emitter that emits two events: `package` and `up-to-date`.
The `up-to-date` event is emitted when the stream reaches the end of all
existing packages, but unlike typical read streams, this stream has no `end`
event. It remains open indefinitely, emitting `package` events as new package
versions are published to the npm registry in real time.


```js
const registry = require('package-stream')()

registry
  .on('package', function (pkg, seq) {
    // pkg: nice clean package object
    // seq: the sequence number of the "package" event, useful for logging/tracking
  })
  .on('up-to-date', function () {
    // consumed all changes (for now)
    // The stream will remain open and continue receiving package
    // updates from the registry as they occur in real time.
  })
```

### Nice Packages

Each object emitted by the `package` event is a 
[nice-package](http://ghub.io/nice-package) instance.
Nice packages have cleaner metadata than you'd get directly from the npm 
registry, and some handy 
[convenience methods](https://github.com/nice-registry/nice-package#convenience-methods)
.

Here's an example that uses the 
[`somehowDependsOn()`](https://github.com/nice-registry/nice-package#pkgsomehowdependsonpkgname) 
method to find all packages the have `choo` in their `dependencies` or 
`devDependencies`:

```js
const registry = require('package-stream')()
const dependents = []

registry
  .on('package', function (pkg) {
    if (pkg.someHowDependsOn('choo')) dependents.push(pkg.name)
  })
  .on('up-to-date', function () {
    process.stdout.write(JSON.stringify(dependents))
    process.exit()
  })
```

To see the full list of available methods, check out the
[nice-package documentation](https://github.com/zeke/nice-package/blob/master/README.md#convenience-methods).

### Options

The [`changes-stream`](http://ghub.io/changes-stream) package is used
under the hood, and
[all of its options](https://github.com/jcrugzz/changes-stream#options)
are supported by `package-stream`. The default options used by `package-stream`
are:

```js
{
  db: 'https://replicate.npmjs.com',
  include_docs: true
}
```

The options you provide are merged with the defaults above.

## Tests

```sh
npm install
npm test
```

## Dependencies

- [changes-stream](https://github.com/jcrugzz/changes-stream): Simple module that handles getting changes from couchdb
- [got](https://github.com/sindresorhus/got): Simplified HTTP requests
- [nice-package](https://github.com/zeke/nice-package): Clean up messy package metadata from the npm registry

## Dev Dependencies

- [tap-spec](https://github.com/scottcorgan/tap-spec): Formatted TAP output like Mocha's spec reporter
- [tape](https://github.com/substack/tape): tap-producing test harness for node and browsers
## License

MIT

_Generated by [package-json-to-readme](https://github.com/zeke/package-json-to-readme)_
